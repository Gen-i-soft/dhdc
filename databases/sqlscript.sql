/*
Navicat MySQL Data Transfer

Source Server         : http://61.19.112.19/
Source Server Version : 50538
Source Host           : 61.19.112.19:3306
Source Database       : dhdc

Target Server Type    : MYSQL
Target Server Version : 50538
File Encoding         : 65001

Date: 2015-04-07 20:30:43
*/

SET FOREIGN_KEY_CHECKS=0;

-- ----------------------------
-- Table structure for sqlscript
-- ----------------------------
DROP TABLE IF EXISTS `sqlscript`;
CREATE TABLE `sqlscript` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `topic` varchar(255) DEFAULT NULL,
  `sql_script` text,
  `user` varchar(255) DEFAULT NULL,
  `d_update` datetime DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=23 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of sqlscript
-- ----------------------------
INSERT INTO `sqlscript` VALUES ('5', 'check_แม่ลูก', 'select  h.hoscode as hospcode ,h.hosname as hospname,\r\n\r\n(select count(*)  from prenatal  \r\n           where (prenatal.edc BETWEEN \'2014-04-01\' and \'2015-03-31\' )  and hospcode = h.hoscode\r\n) as prenatal,\r\n(select count(*)  from labor\r\n           where (labor.bdate BETWEEN \'2014-04-01\' and \'2015-03-31\' ) and hospcode = h.hoscode\r\n) as labor,\r\n(select count(*)  from postnatal  \r\n           where (postnatal.bdate BETWEEN \'2014-04-01\' and \'2015-03-31\' ) and hospcode = h.hoscode\r\n) as postnatal,\r\n(select count(*)  from newborn  \r\n           where (newborn.bdate BETWEEN \'2014-04-01\' and \'2015-03-31\' ) and hospcode = h.hoscode\r\n) as newborn,\r\n(select count(*)  from newborncare  \r\n           where (newborncare.bdate BETWEEN \'2014-04-01\' and \'2015-03-31\' ) and hospcode = h.hoscode\r\n) as newborncare\r\nfrom chospital_amp h\r\n\r\norder by hoscode asc;', 'admin', '2015-03-31 09:55:07');
INSERT INTO `sqlscript` VALUES ('7', 'qof_5ครั้ง12สัปดาห์', 'select h.hoscode as hospcode ,h.hosname as hospname,\r\n(select total from\r\n(select anc.hospcode,count(distinct anc.pid) as total \r\nfrom labor \r\nINNER JOIN anc ON labor.hospcode = anc.hospcode AND labor.pid = anc.pid \r\nINNER JOIN person ON person.hospcode = anc.hospcode AND person.pid = anc.pid \r\nWHERE person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' and person.sex = \'2\' \r\nand labor.bdate BETWEEN \'2014-04-01\' AND curdate()\r\nGROUP BY person.hospcode ) as t\r\nwhere t.hospcode =h.hoscode ) as LaborTarget,\r\n\r\n( select total from\r\n(\r\nselect labor.hospcode,count(*) as total \r\nfrom labor \r\nINNER JOIN \r\n(select anc1.hospcode,anc1.pid,anc1.gravida,count(distinct anc1.pid) as total \r\nfrom anc anc1\r\nWHERE anc1.ga <= 12 \r\nGROUP BY anc1.hospcode,anc1.pid ) as anc1\r\nON labor.hospcode = anc1.hospcode AND labor.pid = anc1.pid\r\ninner join \r\n(select anc2.hospcode,anc2.pid,anc2.gravida,count(distinct anc2.pid) as total \r\nfrom anc anc2\r\nWHERE anc2.ga BETWEEN 16 AND 20 \r\nGROUP BY anc2.hospcode,anc2.pid ) as anc2\r\non anc1.hospcode = anc2.hospcode and anc1.pid = anc2.pid and anc1.gravida = anc2.gravida\r\ninner join \r\n(select anc3.hospcode,anc3.pid,anc3.gravida,count(distinct anc3.pid) as total \r\nfrom anc anc3\r\nWHERE anc3.ga BETWEEN 24 AND 28\r\nGROUP BY anc3.hospcode,anc3.pid ) as anc3\r\non anc1.hospcode = anc3.hospcode and anc1.pid = anc3.pid and anc1.gravida = anc3.gravida\r\ninner join \r\n(select anc4.hospcode,anc4.pid,anc4.gravida,count(distinct anc4.pid) as total \r\nfrom anc anc4\r\nWHERE anc4.ga BETWEEN 30 AND 34\r\nGROUP BY anc4.hospcode,anc4.pid ) as anc4\r\non anc1.hospcode = anc4.hospcode and anc1.pid = anc4.pid and anc1.gravida = anc4.gravida\r\ninner join \r\n(select anc5.hospcode,anc5.pid,anc5.gravida,count(distinct anc5.pid) as total \r\nfrom anc anc5\r\nWHERE anc5.ga BETWEEN 36 AND 40 \r\nGROUP BY anc5.hospcode,anc5.pid ) as anc5\r\non anc1.hospcode = anc5.hospcode and anc1.pid = anc5.pid and anc1.gravida = anc5.gravida\r\n\r\nINNER JOIN person ON person.hospcode = labor.hospcode AND person.pid = labor.pid \r\nWHERE person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' and person.sex = \'2\' \r\nand labor.bdate BETWEEN \'2014-04-01\' AND curdate()\r\nGROUP BY labor.hospcode\r\n) as a5\r\nwhere a5.hospcode = h.hoscode) as 5timesResult,\r\n( select total from\r\n(\r\nselect labor.hospcode,count(*) as total \r\nfrom labor \r\nINNER JOIN \r\n(select anc1.hospcode,anc1.pid,anc1.gravida,count(distinct anc1.pid) as total \r\nfrom anc anc1\r\nWHERE anc1.ga <= 12 \r\nGROUP BY anc1.hospcode,anc1.pid ) as anc1\r\nON labor.hospcode = anc1.hospcode AND labor.pid = anc1.pid\r\nINNER JOIN person ON person.hospcode = labor.hospcode AND person.pid = labor.pid \r\nWHERE person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' and person.sex = \'2\' \r\nand labor.bdate BETWEEN \'2014-04-01\' AND \'2015-09-30\'\r\nGROUP BY labor.hospcode\r\n) as 12wks\r\nwhere 12wks.hospcode = h.hoscode) as 12wksResult\r\n\r\nfrom chospital_amp h\r\n\r\norder by distcode,hoscode asc;', 'admin', '2015-03-31 10:17:54');
INSERT INTO `sqlscript` VALUES ('8', 'กรุณาแก้ชื่อ script', 'select h.hoscode as hospcode ,h.hosname as hospname,\r\n(select total from\r\n(select anc.hospcode,count(distinct anc.pid) as total \r\nfrom labor \r\nINNER JOIN anc ON labor.hospcode = anc.hospcode AND labor.pid = anc.pid \r\nINNER JOIN person ON person.hospcode = anc.hospcode AND person.pid = anc.pid \r\nWHERE person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' and person.sex = \'2\' \r\nand labor.bdate BETWEEN \'2014-04-01\' AND curdate()\r\nGROUP BY person.hospcode ) as t\r\nwhere t.hospcode =h.hoscode ) as LaborTarget,\r\n\r\n( select total from\r\n(\r\nselect labor.hospcode,count(*) as total \r\nfrom labor \r\nINNER JOIN \r\n(select anc1.hospcode,anc1.pid,anc1.gravida,count(distinct anc1.pid) as total \r\nfrom anc anc1\r\nWHERE anc1.ga <= 12 \r\nGROUP BY anc1.hospcode,anc1.pid ) as anc1\r\nON labor.hospcode = anc1.hospcode AND labor.pid = anc1.pid\r\ninner join \r\n(select anc2.hospcode,anc2.pid,anc2.gravida,count(distinct anc2.pid) as total \r\nfrom anc anc2\r\nWHERE anc2.ga BETWEEN 16 AND 20 \r\nGROUP BY anc2.hospcode,anc2.pid ) as anc2\r\non anc1.hospcode = anc2.hospcode and anc1.pid = anc2.pid and anc1.gravida = anc2.gravida\r\ninner join \r\n(select anc3.hospcode,anc3.pid,anc3.gravida,count(distinct anc3.pid) as total \r\nfrom anc anc3\r\nWHERE anc3.ga BETWEEN 24 AND 28\r\nGROUP BY anc3.hospcode,anc3.pid ) as anc3\r\non anc1.hospcode = anc3.hospcode and anc1.pid = anc3.pid and anc1.gravida = anc3.gravida\r\ninner join \r\n(select anc4.hospcode,anc4.pid,anc4.gravida,count(distinct anc4.pid) as total \r\nfrom anc anc4\r\nWHERE anc4.ga BETWEEN 30 AND 34\r\nGROUP BY anc4.hospcode,anc4.pid ) as anc4\r\non anc1.hospcode = anc4.hospcode and anc1.pid = anc4.pid and anc1.gravida = anc4.gravida\r\ninner join \r\n(select anc5.hospcode,anc5.pid,anc5.gravida,count(distinct anc5.pid) as total \r\nfrom anc anc5\r\nWHERE anc5.ga BETWEEN 36 AND 40 \r\nGROUP BY anc5.hospcode,anc5.pid ) as anc5\r\non anc1.hospcode = anc5.hospcode and anc1.pid = anc5.pid and anc1.gravida = anc5.gravida\r\n\r\nINNER JOIN person ON person.hospcode = labor.hospcode AND person.pid = labor.pid \r\nWHERE person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' and person.sex = \'2\' \r\nand labor.bdate BETWEEN \'2014-04-01\' AND curdate()\r\nGROUP BY labor.hospcode\r\n) as a5\r\nwhere a5.hospcode = h.hoscode) as 5timesResult,\r\n( select total from\r\n(\r\nselect labor.hospcode,count(*) as total \r\nfrom labor \r\nINNER JOIN \r\n(select anc1.hospcode,anc1.pid,anc1.gravida,count(distinct anc1.pid) as total \r\nfrom anc anc1\r\nWHERE anc1.ga <= 12 \r\nGROUP BY anc1.hospcode,anc1.pid ) as anc1\r\nON labor.hospcode = anc1.hospcode AND labor.pid = anc1.pid\r\nINNER JOIN person ON person.hospcode = labor.hospcode AND person.pid = labor.pid \r\nWHERE person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' and person.sex = \'2\' \r\nand labor.bdate BETWEEN \'2014-04-01\' AND \'2015-09-30\'\r\nGROUP BY labor.hospcode\r\n) as 12wks\r\nwhere 12wks.hospcode = h.hoscode) as 12wksResult\r\n\r\nfrom chospital_amp h\r\n\r\norder by distcode,hoscode asc;', 'U07593', '2015-03-31 10:22:02');
INSERT INTO `sqlscript` VALUES ('9', 'qof_รายชื่อ_preg', 'set @hospcode = \'25022\';\r\nselect DISTINCT anc.pid ,anc.hospcode ,person.`NAME` ,person.LNAME\r\nfrom labor \r\nINNER JOIN anc ON labor.hospcode = anc.hospcode AND labor.pid = anc.pid \r\nINNER JOIN person ON person.hospcode = anc.hospcode AND person.pid = anc.pid \r\nWHERE \r\nperson.discharge = \'9\' \r\nand person.typearea in (\'1\', \'3\') \r\nand person.nation =\'099\' and person.sex = \'2\' \r\nand labor.bdate BETWEEN \'2014-04-01\' AND curdate()\r\n\r\nand anc.HOSPCODE = @hospcode;', 'admin', '2015-03-31 10:40:26');
INSERT INTO `sqlscript` VALUES ('13', 'รายชื่อวัคซีน', 'set @start=\'2009-04-01\';\r\nset @end=\'2010-03-31\';\r\nset @vac=\'035\';\r\nset @hosp=\'07588\';\r\nselect distinct person.hospcode,person.pid,person.name,person.lname,\r\nif((select count(*) from epi e where e.vaccinetype=@vac and concat(e.pid,e.hospcode)=concat(person.pid,person.hospcode))>0,1,0) as vac_chk from person  \r\n          left join epi on epi.hospcode = person.hospcode and epi.pid = person.pid  \r\n           where person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\'  \r\n           and (person.birth BETWEEN @start and @end)  \r\n and person.hospcode = @hosp \r\ngroup by person.hospcode,person.pid\r\nhaving vac_chk = 0\r\norder by person.pid;', 'admin', '2015-03-31 11:35:55');
INSERT INTO `sqlscript` VALUES ('14', 'lab เบาหวาน', 'set @start=\'2014-04-01\';\r\nset @end=\'2015-03-31\';\r\nset @bdg_date = \'2014-09-30\';\r\n\r\nselect  h.distcode as amphur,h.hoscode as hospcode ,concat(provcode,distcode,subdistcode,mu) as areacode,h.hosname as hospname,\r\n\r\n(SELECT  hos_chronic from \r\n          (select person.hospcode,count(distinct(person.pid)) as hos_chronic from chronic  \r\n           inner join person on chronic.hospcode = person.hospcode and chronic.pid = person.pid\r\n           where person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' and  (chronic.chronic between \'E10\' and \'E149\')  \r\n             group by person.hospcode) as c\r\nwhere c.hospcode  = h.hoscode\r\n) as DMtarget,\r\n(SELECT hos_doit from\r\n          (select person.hospcode,count(distinct(person.pid)) as hos_doit from chronic  \r\n           inner join person on chronic.hospcode = person.hospcode and chronic.pid = person.pid \r\n           inner join labfu on person.hospcode = labfu.hospcode and person.pid = labfu.pid \r\n           where person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' and  (chronic.chronic between \'E10\' and \'E149\')  \r\n           and labfu.labtest in (\'01\',\'02\',\'03\') and (labfu.date_serv BETWEEN @start and @end ) \r\n             group by person.hospcode) as r\r\nwhere r.hospcode = h.hoscode\r\n) as Fbs,\r\n(SELECT hos_doit from\r\n          (select person.hospcode,count(distinct(person.pid)) as hos_doit from chronic  \r\n           inner join person on chronic.hospcode = person.hospcode and chronic.pid = person.pid \r\n           inner join labfu on person.hospcode = labfu.hospcode and person.pid = labfu.pid \r\n           where person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' and  (chronic.chronic between \'E10\' and \'E149\')  \r\n           and labfu.labtest = \'05\' and (labfu.date_serv BETWEEN @start and @end ) \r\n             group by person.hospcode) as r\r\nwhere r.hospcode = h.hoscode\r\n) as Hba1c,\r\n(SELECT hos_doit from\r\n          (select person.hospcode,count(distinct(person.pid)) as hos_doit from chronic  \r\n           inner join person on chronic.hospcode = person.hospcode and chronic.pid = person.pid \r\n           inner join labfu on person.hospcode = labfu.hospcode and person.pid = labfu.pid \r\n           where person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' and  (chronic.chronic between \'E10\' and \'E149\')  \r\n           and labfu.labtest = \'06\' and (labfu.date_serv BETWEEN @start and @end ) \r\n             group by person.hospcode) as r\r\nwhere r.hospcode = h.hoscode\r\n) as TG,\r\n(SELECT hos_doit from\r\n          (select person.hospcode,count(distinct(person.pid)) as hos_doit from chronic  \r\n           inner join person on chronic.hospcode = person.hospcode and chronic.pid = person.pid \r\n           inner join labfu on person.hospcode = labfu.hospcode and person.pid = labfu.pid \r\n           where person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' and  (chronic.chronic between \'E10\' and \'E149\')  \r\n           and labfu.labtest = \'07\' and (labfu.date_serv BETWEEN @start and @end ) \r\n             group by person.hospcode) as r\r\nwhere r.hospcode = h.hoscode\r\n) as TC,\r\n(SELECT hos_doit from\r\n          (select person.hospcode,count(distinct(person.pid)) as hos_doit from chronic  \r\n           inner join person on chronic.hospcode = person.hospcode and chronic.pid = person.pid \r\n           inner join labfu on person.hospcode = labfu.hospcode and person.pid = labfu.pid \r\n           where person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' and  (chronic.chronic between \'E10\' and \'E149\')  \r\n           and labfu.labtest = \'08\' and (labfu.date_serv BETWEEN @start and @end ) \r\n             group by person.hospcode) as r\r\nwhere r.hospcode = h.hoscode\r\n) as HDL,\r\n(SELECT hos_doit from\r\n          (select person.hospcode,count(distinct(person.pid)) as hos_doit from chronic  \r\n           inner join person on chronic.hospcode = person.hospcode and chronic.pid = person.pid \r\n           inner join labfu on person.hospcode = labfu.hospcode and person.pid = labfu.pid \r\n           where person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' and  (chronic.chronic between \'E10\' and \'E149\')  \r\n           and labfu.labtest = \'09\' and (labfu.date_serv BETWEEN @start and @end ) \r\n             group by person.hospcode) as r\r\nwhere r.hospcode = h.hoscode\r\n) as LDL,\r\n(SELECT hos_doit from\r\n          (select person.hospcode,count(distinct(person.pid)) as hos_doit from chronic  \r\n           inner join person on chronic.hospcode = person.hospcode and chronic.pid = person.pid \r\n           inner join labfu on person.hospcode = labfu.hospcode and person.pid = labfu.pid \r\n           where person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' and  (chronic.chronic between \'E10\' and \'E149\')  \r\n           and labfu.labtest = \'12\' and (labfu.date_serv BETWEEN @start and @end ) \r\n             group by person.hospcode) as r\r\nwhere r.hospcode = h.hoscode\r\n) as MicroAlb \r\n\r\nfrom chospital_amp h\r\n\r\norder by distcode,hoscode asc;', 'admin', '2015-03-31 11:47:03');
INSERT INTO `sqlscript` VALUES ('15', 'lab ความดัน', 'set @start=\'2014-04-01\';\r\nset @end=\'2015-03-31\';\r\nset @bdg_date = \'2014-09-30\';\r\n\r\nselect  h.distcode as amphur,h.hoscode as hospcode ,concat(provcode,distcode,subdistcode,mu) as areacode,h.hosname as hospname,\r\n\r\n(SELECT  hos_chronic from \r\n          (select person.hospcode,count(distinct(person.pid)) as hos_chronic from chronic  \r\n           inner join person on chronic.hospcode = person.hospcode and chronic.pid = person.pid\r\n           where person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' and  (chronic.chronic between \'I10\' and \'I159\')  \r\n             group by person.hospcode) as c\r\nwhere c.hospcode  = h.hoscode\r\n) as target,\r\n(SELECT hos_doit from\r\n          (select person.hospcode,count(distinct(person.pid)) as hos_doit from chronic  \r\n           inner join person on chronic.hospcode = person.hospcode and chronic.pid = person.pid \r\n           inner join labfu on person.hospcode = labfu.hospcode and person.pid = labfu.pid \r\n           where person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' and  (chronic.chronic between \'I10\' and \'I159\')  \r\n           and labfu.labtest in (\'01\',\'02\',\'03\') and (labfu.date_serv BETWEEN @start and @end ) \r\n             group by person.hospcode) as r\r\nwhere r.hospcode = h.hoscode\r\n) as Fbs,\r\n(SELECT hos_doit from\r\n          (select person.hospcode,count(distinct(person.pid)) as hos_doit from chronic  \r\n           inner join person on chronic.hospcode = person.hospcode and chronic.pid = person.pid \r\n           inner join labfu on person.hospcode = labfu.hospcode and person.pid = labfu.pid \r\n           where person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' and  (chronic.chronic between \'I10\' and \'I159\')  \r\n           and labfu.labtest = \'09\' and (labfu.date_serv BETWEEN @start and @end ) \r\n             group by person.hospcode) as r\r\nwhere r.hospcode = h.hoscode\r\n) as LDL,\r\n(SELECT hos_doit from\r\n          (select person.hospcode,count(distinct(person.pid)) as hos_doit from chronic  \r\n           inner join person on chronic.hospcode = person.hospcode and chronic.pid = person.pid \r\n           inner join labfu on person.hospcode = labfu.hospcode and person.pid = labfu.pid \r\n           where person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' and  (chronic.chronic between \'I10\' and \'I159\')  \r\n           and labfu.labtest = \'11\' and (labfu.date_serv BETWEEN @start and @end ) \r\n             group by person.hospcode) as r\r\nwhere r.hospcode = h.hoscode\r\n) as Creatinine,\r\n(SELECT hos_doit from\r\n          (select person.hospcode,count(distinct(person.pid)) as hos_doit from chronic  \r\n           inner join person on chronic.hospcode = person.hospcode and chronic.pid = person.pid \r\n           inner join labfu on person.hospcode = labfu.hospcode and person.pid = labfu.pid \r\n           where person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' and  (chronic.chronic between \'I10\' and \'I159\')  \r\n           and labfu.labtest = \'14\' and (labfu.date_serv BETWEEN @start and @end ) \r\n             group by person.hospcode) as r\r\nwhere r.hospcode = h.hoscode\r\n) as Macroalbumine \r\n\r\nfrom chospital_amp h\r\n\r\norder by distcode,hoscode asc;', 'admin', '2015-03-31 11:48:57');
INSERT INTO `sqlscript` VALUES ('16', 'หญิงกลุ่มเป้าหมาย', 'set @h = \'07590\';\r\nset @bdg_date = \'2014-09-30\';\r\nset @start = \'2014-10-01\';\r\nset @end = \'2015-03-31\';\r\nselect person.hospcode ,person.cid,person.pid,person.name,person.lname,TIMESTAMPDIFF(YEAR,person.birth,@bdg_date) as age  \r\nfrom person  \r\n           where \r\nperson.discharge = \'9\' \r\nand person.typearea in (\'1\', \'3\') \r\nand person.nation =\'099\' \r\nand  TIMESTAMPDIFF(YEAR,person.birth,@bdg_date) between 30 and 60\r\nand sex = \'2\' \r\nand person.hospcode =  @h;', 'admin', '2015-03-31 14:19:51');
INSERT INTO `sqlscript` VALUES ('17', 'กรุณาแก้ชื่อ script', 'set @start=\'2014-10-01\';\r\nset @end=\'2015-03-31\';\r\nset @bdg_date = \'2014-09-30\';\r\n\r\nselect ncdscreen_all.*,format(ncdscreen_all.htresult*100/ncdscreen_all.httarget,2) as HTpercent from \r\n(select  h.distcode as amphur,h.hoscode as hospcode ,concat(provcode,distcode,subdistcode,mu) as areacode,h.hosname as hospname,\r\n(SELECT hos_target from\r\n (select person.hospcode , count(distinct person.pid) as hos_target from person  \r\n           where person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' \r\n           and (TIMESTAMPDIFF(YEAR,person.birth,@bdg_date) >= 35 )\r\n            group by person.hospcode ) as t\r\nwhere  t.hospcode = h.hoscode\r\n) as Pop ,\r\n(SELECT  hos_chronic from \r\n          (select person.hospcode,count(distinct(person.pid)) as hos_chronic from chronic  \r\n           inner join person on chronic.hospcode = person.hospcode and chronic.pid = person.pid \r\n           where person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' \r\n           and (TIMESTAMPDIFF(YEAR,person.birth,@bdg_date) >= 35 ) and (chronic.chronic between \'I10\' and \'I159\') \r\n             group by person.hospcode) as c\r\nwhere c.hospcode  = h.hoscode\r\n) as HT,\r\n(SELECT hos_target from\r\n (select person.hospcode , count(*) as hos_target from person  \r\n           where person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' \r\n           and (TIMESTAMPDIFF(YEAR,person.birth,@bdg_date) >= 35 )\r\n           and concat(person.hospcode ,person.pid) not in  \r\n           ( select concat(hospcode,pid) from chronic c where c.chronic between \'I10\' and \'I159\' )\r\ngroup by person.hospcode ) as t\r\nwhere  t.hospcode = h.hoscode\r\n) as HTtarget ,\r\n(SELECT hos_doit from\r\n          (select person.hospcode,count(*) as hos_doit from ncdscreen  \r\n           inner join person on ncdscreen.hospcode = person.hospcode and ncdscreen.pid = person.pid \r\n           where person.discharge = \'9\' and person.typearea in (\'1\', \'3\') and person.nation =\'099\' \r\n           and (TIMESTAMPDIFF(YEAR,person.birth,@bdg_date) >= 35 ) and date_serv between @start and @end \r\n            \r\n           and concat(person.hospcode,person.pid) not in  \r\n           ( select concat(c.hospcode,c.pid) from chronic c where c.chronic between \'I10\' and \'I159\' ) group by person.hospcode) as r\r\nwhere r.hospcode = h.hoscode\r\n) as HTresult\r\n\r\nfrom chospital_amp h\r\norder by distcode,hoscode asc) as ncdscreen_all;', 'admin', '2015-03-31 15:20:50');
INSERT INTO `sqlscript` VALUES ('20', 'จิตเวช.txt', 'SELECT h.hoscode,h.hosname ,\r\nsum(if(substr(upper(d.DIAGCODE),1,3) between \'F00\' and \'F09\',1,0)) \'ความผิดปกติทางจิตและอาการทางจิตที่เกิดจากโรคทางกาย\',\r\nsum(if(substr(upper(d.DIAGCODE),1,3) between \'F10\' and \'F19\',1,0)) \'ความผิดปกติทางจิตและพฤติกรรมที่เกิดจากการใช้สารออกฤทธิ์ต่อจิตประสาท\' ,\r\nsum(if(substr(upper(d.DIAGCODE),1,3) between \'F20\' and \'F29\',1,0)) \'โรคจิตเภท พฤติกรรมแบบโรคจิตเภท และโรคหลงผิด\' ,\r\nsum(if(substr(upper(d.DIAGCODE),1,3) between \'F30\' and \'F39\',1,0)) \'ความผิดปกติทางอารมณ์\' ,\r\nsum(if(substr(upper(d.DIAGCODE),1,3) between \'F40\' and \'F49\',1,0)) \'โรคประสาท ความผิดปกติที่สัมพันธ์กับความเครียด และโรคโซมาโตฟอร์ม\' ,\r\nsum(if(substr(upper(d.DIAGCODE),1,3) between \'F50\' and \'F59\',1,0)) \'กลุ่มอาการทางพฤติกรรมที่พบร่วมกับความผิดปกติทางสรีรวิทยาและปัจจัยทางกายภาพ\',\r\nsum(if(substr(upper(d.DIAGCODE),1,3) between \'F60\' and \'F69\',1,0)) \'ความผิดปกติทางบุคลิกภาพและพฤติกรรมของผู้ใหญ่\' ,\r\nsum(if(substr(upper(d.DIAGCODE),1,3) between \'F70\' and \'F79\',1,0)) \'ภาวะปัญญาอ่อน\' ,\r\nsum(if(substr(upper(d.DIAGCODE),1,3) between \'F80\' and \'F89\',1,0)) \'ความผิดปกติของพัฒนาการทางจิต\' ,\r\nsum(if(substr(upper(d.DIAGCODE),1,3) between \'F90\' and \'F98\',1,0)) \'ความผิดปกติทางอารมณ์และพฤติกรรมที่มักเริ่มต้นในวัยเด็กและวัยรุ่น\' ,\r\nsum(if(substr(upper(d.DIAGCODE),1,3) = \'F99\',1,0)) \'ความผิดปกติทางจิตที่ไม่ระบุรายละเอียด\' \r\nfrom diagnosis_opd d INNER JOIN chospital_amp h on d.HOSPCODE=h.hoscode INNER JOIN campur on h.provcode = campur.changwatcode AND h.distcode = campur.ampurcode \r\nwhere d.DATE_SERV BETWEEN \'2014-10-01\' AND \'2015-09-30\' GROUP BY h.hoscode;', 'admin', '2015-04-07 20:01:48');
INSERT INTO `sqlscript` VALUES ('22', 'เด็ก 5 ปีได้รับ DTP5', 'SET @bdg_date = CURDATE();\r\nSELECT  h.hoscode,h.hosname\r\n,(\r\n	SELECT COUNT(DISTINCT  p.PID) FROM person p\r\n	WHERE p.HOSPCODE = h.hoscode\r\n	AND p.discharge = \'9\' and p.typearea in (\'1\', \'3\') and p.nation =\'099\'\r\n	AND TIMESTAMPDIFF(MONTH,p.BIRTH,@bdg_date) <= 71\r\n) as target\r\n,(\r\n	SELECT COUNT(DISTINCT e.PID) FROM epi e	\r\n	INNER JOIN person p on p.HOSPCODE = e.HOSPCODE AND p.PID = e.PID	\r\n	WHERE \r\n	e.HOSPCODE = h.hoscode\r\n	AND e.VACCINETYPE = \'035\'\r\n	AND p.discharge = \'9\' and p.typearea in (\'1\', \'3\') and p.nation =\'099\'\r\n	AND TIMESTAMPDIFF(MONTH,p.BIRTH,@bdg_date) <= 71\r\n\r\n) as result\r\n\r\n FROM chospital_amp h;', 'admin', '2015-04-07 20:22:35');
